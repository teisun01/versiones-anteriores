<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>web principal</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@900&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b0b0f; --muted:#d6d6d8; }
    html, body {
      height: 100%; margin: 0; width: 100%; max-width: 100%;
      font-family: 'Merriweather', serif;
      background-color: var(--bg);
      background-image: url("img/pasto-recortado.png"), url("img/pasto-recortado.png");
      background-repeat: no-repeat, repeat-y;
      background-position: center top, center top;
      background-size: cover, cover;
      color: var(--muted);
    }

    img, .parallax-fotos, .parallax-descendiente, .titulo {
      max-width: 100%; height: auto;
    }

    .contenedor{ position:relative; width:100%; margin:0 auto; }
    .escenario {
      position: relative; height: 100vh; overflow: hidden;
      display: flex; align-items: flex-start; justify-content: center;
      text-align: center; flex-direction: column;
    }

    .titulo{ position:absolute; z-index:102; width:600px; top:40%; left:10%; transform:none; }

    .parallax-fotos, .parallax-descendiente, #arbolesfondo-solo {
      position: absolute; top: 0; left: 50%; transform: translateX(-50%);
      pointer-events: none;
    }
    .parallax-fotos{ width:100%; height:auto; max-width:none; }

    #arbolesfondo-solo {
      width: 100%; height: 100vh;
      background-size: cover;
      background-image: url("img/arbolesfondo-solo.png");
      background-repeat: repeat-x; background-position: top center;
      z-index: 0;
    }

    #hojasarbol{z-index:98;} #layer-brilloramas{z-index:99;}
    #ramas{z-index:100;} #layer-brilloraices{z-index:101;}
    #layer-descendiente{z-index:103;}

    #hojasarbol, #layer-brilloramas, #ramas,
    #layer-brilloraices, #layer-descendiente {
      position: absolute; top:0; left:50%; transform:translateX(-50%);
      width:100%; max-width:1920px; height:auto;
      will-change: transform, opacity;
    }

    /* --- Brillos --- */
    #layer-brilloramas { animation: twinkle 4s infinite ease-in-out; opacity:0.05; }
    @keyframes twinkle { 0%,100%{opacity:0.05;} 50%{opacity:1;} }

    /* Base */
    #layer-brilloraices.base {
      opacity:0.1;
      animation: glowBase 6s infinite ease-in-out;
    }
    @keyframes glowBase { 0%,100%{opacity:0.1;} 50%{opacity:0.3;} }

    /* Active */
    #layer-brilloraices.active {
      animation: glowActive 4s infinite ease-in-out;
    }
    @keyframes glowActive { 0%,100%{opacity:0.5;} 50%{opacity:1;} }

    section.historia {
      min-height: 100vh; padding: 80px; z-index: 2;
      display: flex; flex-direction: column; text-align: left;
    }

    /* 🔹 Texto fluido */
section.historia h2 { 
  font-size: clamp(28px, 2vw + 1rem, 64px); 
  margin-bottom: 20px; 
  color: #fff; 
}
section.historia p { 
  font-size: clamp(16px, 1.2vw + 0.5rem, 28px); 
  line-height:1.6; 
  color:#fff; 
  max-width:800px; 
}

    @media (max-width: 768px) {
      #arbolesfondo-solo{ left:80%; width:180vw; height:140vh; background-size:cover; background-repeat:no-repeat; background-position:center top; }
      #arbol-amarillo{ left:75%; transform:translateX(-50%) translateY(280px)!important; width:150%; }
      #selen{ left:85%!important; transform:translateX(-50%) translateY(180px)!important; width:200%; }
      .titulo{ top:45%; left:50%; transform:translateX(-50%) translateY(-200px)!important; width:80%; max-width:350px; }
      section.historia{ padding:40px 20px; text-align:center; }
      section.historia h2{ font-size: clamp(18px, 5vw, 28px); }
      section.historia p{ font-size: clamp(14px, 4vw, 20px); max-width:100%; }
      #hojasarbol,#layer-brilloramas,#ramas,#layer-brilloraices,#layer-descendiente {
        transform:translateX(-50%) translateY(1000px); width:180%;
      }
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <div class="escenario" id="escenario">
      <div id="arbolesfondo-solo"></div>
      <img class="parallax-fotos" id="arbol-amarillo" src="img/arbol-amarillo.png" alt="árbol amarillo" />
      <img class="parallax-fotos" id="selen" src="img/selen.png" alt="selen" />
      <img class="titulo" id="titulo-morthalis" src="img/morthalis.png" alt="Título gráfico" />
    </div>

    <img class="parallax-fotos" id="hojasarbol" src="img/hojasarbol.png" alt="hojas del árbol" />
    <img class="parallax-fotos" id="layer-brilloramas" src="img/brilloramas.png" alt="brillo ramas" />
    <img class="parallax-fotos" id="ramas" src="img/arbolramas.png" alt="ramas del árbol" />
    <img class="parallax-fotos base" id="layer-brilloraices" src="img/brilloraices.png" alt="brilloraices" />
    <img class="parallax-descendiente" id="layer-descendiente" src="img/descendiente.png" alt="descendiente" />

    <section id="capitulo1" class="historia">
      <h2 class="subtitulo">Un nuevo eco en el silencio</h2>
      <p class="parrafo">
       La ausencia tiene un nuevo nombre, 
       y no es el final. Se dice que al partir, 
       el alma no se desvanece, sino que se alza, enraizada. 
       El recuerdo se vuelve tangible, custodiado en un cristal que pulsa con la memoria colectiva. 
       ¿Es la muerte una metamorfosis? Prepárate para el evento que redefinirá el legado y la conexión. 
       El ciclo está por revelarse.
      </p>
    </section>
  </div>

<script>
  const capas = [
    {el: document.getElementById('arbol-amarillo'), speed: 0.33},
    {el: document.getElementById('selen'), speed: 0.45}
  ];
  const arbolesfondo = document.getElementById('arbolesfondo-solo');
  const hojas = document.getElementById('hojasarbol');
  const brilloramas = document.getElementById('layer-brilloramas');
  const ramas = document.getElementById('ramas');
  const brilloraices = document.getElementById('layer-brilloraices');
  const descendiente = document.getElementById('layer-descendiente');
  const capitulo1 = document.getElementById('capitulo1');

  let scrollActual = 0, actualizando = false;
  const porcentajeActivacion = 0.5;

  const descendientePosicion = 0;
  const arbolAmarilloPosicion = 120;

  function getScrollPercent(){
    const scrollY = window.scrollY||window.pageYOffset;
    const doc=document.documentElement;
    const h=Math.max(doc.scrollHeight,doc.offsetHeight,doc.clientHeight);
    const winH=window.innerHeight||doc.clientHeight;
    return scrollY/Math.max(1, (h-winH));
  }

  function onScroll(){
    scrollActual = window.scrollY||window.pageYOffset;
    if(!actualizando) requestAnimationFrame(update);
    actualizando = true;
    revisarBrilloraices();
  }

  function update(){
    const y = scrollActual;
    // mueve fondo arboles
    arbolesfondo.dataset.scrollY = y*0.22;
    arbolesfondo.style.backgroundPositionY = `${arbolesfondo.dataset.scrollY}px`;

    // mueve capas
    capas.forEach(l=>{
      const t = y * l.speed;
      l.el.dataset.scrollY = t;
      let offset = t;
      if (l.el.id === "arbol-amarillo") offset += arbolAmarilloPosicion;
      l.el.style.transform = `translateX(-50%) translateY(${offset}px)`;
    });

    if (capitulo1) {
      const limite = capitulo1.offsetTop - 800;
      const offset = Math.min(y, limite);

      [hojas, brilloramas, ramas, brilloraices].forEach(l=>{
        if (l) l.style.transform = `translateX(-50%) translateY(${offset}px)`;
      });

      if (descendiente) {
        descendiente.style.transform = `translateX(-50%) translateY(${offset + descendientePosicion}px)`;
      }
    }

    actualizando = false;
  }

  function setBase(){
    if (!brilloraices) return;
    brilloraices.classList.remove('active');
    if (!brilloraices.classList.contains('base')) brilloraices.classList.add('base');
  }
  function setActive(){
    if (!brilloraices) return;
    brilloraices.classList.remove('base');
    if (!brilloraices.classList.contains('active')) brilloraices.classList.add('active');
  }

  function revisarBrilloraices(){
    const percent = getScrollPercent();
    if (percent >= porcentajeActivacion) setActive();
    else setBase();
  }

  window.addEventListener('scroll', onScroll, { passive: true });
  window.addEventListener('resize', ()=>{ update(); revisarBrilloraices(); });

  if (brilloraices && !brilloraices.classList.contains('base') && !brilloraices.classList.contains('active')) {
    brilloraices.classList.add('base');
  }
  update();
  revisarBrilloraices();

  const arbolAmarillo = document.getElementById("arbol-amarillo");
  const selen = document.getElementById("selen");

  // Movimiento con mouse
  window.addEventListener("mousemove", e=>{
    const x = (e.clientX/window.innerWidth) - 0.5;
    const y = (e.clientY/window.innerHeight) - 0.5;

    const fondoScrollY = parseFloat(arbolesfondo.dataset.scrollY||0);

    // 🔹 Solo izquierda en X: nunca valores positivos
    let offsetX = x * 30;
    if(offsetX > 0) offsetX = 0;   // no se mueve a la derecha
    if(offsetX < -50) offsetX = -50; // límite a la izquierda
    // 🔹 En Y solo baja
    const offsetY = fondoScrollY + Math.min(0, y * 0.04 * 100);

    arbolesfondo.style.backgroundPosition = `${offsetX}px ${offsetY}px`;

    const arbolAmarilloScrollY = parseFloat(arbolAmarillo.dataset.scrollY||0);
    arbolAmarillo.style.transform = `translateX(calc(-50% + ${x * 15}px)) translateY(${arbolAmarilloScrollY + arbolAmarilloPosicion + y * 0.04 * 40}px)`;

    const selenScrollY = parseFloat(selen.dataset.scrollY||0);
    selen.style.transform = `translateX(calc(-50% + ${x * -60}px)) translateY(${selenScrollY + y * 0.04 * 200}px)`;
  });
</script>
</body>
</html>
