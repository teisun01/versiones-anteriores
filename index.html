
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parallax Storytelling — Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@900&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0f;
      --muted:#d6d6d8;
    }
    html, body {
      min-height: 100%;
      margin: 0;
      font-family: 'Merriweather', serif;
      background-color: var(--bg);
      background-image: 
        url("img/pasto-recortado.png"),
        url("img/pasto-recortado.png");
      background-repeat: 
        no-repeat,
        repeat-y;
      background-position: 
        center top,
        center top;
      background-size: 
        cover,
        cover;
      color: var(--muted);
    }

    .container { position:relative; width:100%; overflow:visible; }

    .stage {
      position: relative;
      min-height: 120vh;
      overflow: hidden;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      text-align: center;
      flex-direction: column;
    }

    .parallax-layer{
      position:absolute;
      top:0;
      left:50%;
      transform:translateX(-50%);
      will-change:transform;
      pointer-events:none;
      width:100vw;
      height:auto;
      min-height:100%;
      max-width:none;
      object-fit:cover;
    }

    #layer-moon {
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:200vh;
      pointer-events:none;
      z-index: 0;
      background-image: url("img/arbolesfondo-solo.png");
      background-repeat: repeat-x;
      background-size: auto auto;
      background-position: top center;
    }

    #layer-forest{ z-index:100; }

    #layer-brilloraices{
      z-index:101;
      opacity:0;
      transition: opacity 1.5s ease-in-out;
    }
    #layer-brilloraices.visible{ opacity:1; }

    .layer-title{
      position:relative;
      z-index:102;
      width:clamp(200px, 60vw, 600px);
      margin:6vh auto 1rem;
      display:block;
    }

    section.story {
      position: relative;
      z-index: 2;
      min-height: 70vh;
      padding: 8vh 8vw;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      flex-direction: column;
      text-align: left;
    }

    section.story h2 {
      font-size: clamp(18px, 4vw, 28px);
      margin-bottom: 1rem;
      color: #fff;
    }

    section.story p {
      font-size: clamp(14px, 2.5vw, 18px);
      line-height: 1.6;
      color: #fff;
    }
    section.story h2,
    section.story p { max-width: 600px; margin-left: 0vw; }

    .parallax-descendiente {
      position: absolute;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
      width: clamp(260px, 70vw, 2000px);
      z-index: 102;
      pointer-events: none;
    }

    /* Tablets */
    @media (max-width: 768px) {
      .stage { min-height: 160vh; }
      section.story { min-height: 90vh; }
    }

    /* Móviles chicos */
    @media (max-width: 480px) {
      .stage { min-height: 200vh; }
      section.story { min-height: 100vh; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="stage" id="stage">
      <div id="layer-moon"></div>
      <img class="parallax-layer" id="layer-clouds" src="img/arbol-amarillo.png" alt="nubes" />
      <img class="parallax-layer" id="layer-mountains" src="img/selen.png" alt="montañas" />
      <img class="layer-title" id="layer-foreground" src="img/morthalis.png" alt="Título gráfico" />
    </div>

    <!-- Árbol y overlay brilloraices -->
    <img class="parallax-layer" id="layer-forest" src="img/arbol.png" alt="bosque" />
    <img class="parallax-layer" id="layer-brilloraices" src="img/brilloraices.png" alt="brilloraices" />

    <!-- Personaje descendiente -->
    <img class="parallax-descendiente" id="layer-descendiente" src="img/descendiente.png" alt="descendiente" />

    <section id="chapter1" class="story">
      <h2 class="subtitulo">Un nuevo eco en el silencio</h2>
      <p class="parrafo">
       La ausencia tiene un nuevo nombre, 
       y no es el final. Se dice que al partir, 
       el alma no se desvanece, sino que se alza, enraizada. 
       El recuerdo se vuelve tangible, custodiado en un cristal que pulsa con la memoria colectiva. 
       ¿Es la muerte una metamorfosis? Prepárate para el evento que redefinirá el legado y la conexión. 
       El ciclo está por revelarse.
      </p>
    </section>
  </div>

  <script>
    const layers = [
      {el: document.getElementById('layer-clouds'), speed: 0.33},
      {el: document.getElementById('layer-mountains'), speed: 0.45}
    ];

    const moonLayer = document.getElementById('layer-moon');
    const forest = document.getElementById('layer-forest');
    const brilloraices = document.getElementById('layer-brilloraices');
    const descendiente = document.getElementById('layer-descendiente');
    const chapter1 = document.getElementById('chapter1');

    let latestKnownScrollY = 0, ticking = false;

    // Ajuste horizontal opcional
    const offsetX = 0;

    function onScroll(){
      latestKnownScrollY = window.scrollY || window.pageYOffset;
      if(!ticking){ requestAnimationFrame(update); }
      ticking = true;
    }

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    function update(){
      const y = latestKnownScrollY;

      // fondo repetido (moon)
      moonLayer.dataset.scrollY = y * 0.22;
      moonLayer.style.backgroundPositionY = `${moonLayer.dataset.scrollY}px`;

      // capas normales
      layers.forEach(layer=>{
        const factor = layer.speed;
        const translate = y * factor;
        layer.el.dataset.scrollY = translate;
        layer.el.style.transform = `translateX(-50%) translateY(${translate}px)`;
      });

      // Árbol + brilloraices
      if(forest && chapter1){
        const limite = chapter1.offsetTop - window.innerHeight * 0.9;
        const offset = Math.min(y, limite);
        forest.style.transform = `translateX(-50%) translateY(${offset}px)`;

        if(brilloraices){
          brilloraices.style.transform = `translateX(-50%) translateY(${offset}px)`;
          if(y > limite * 0.7){
            brilloraices.classList.add("visible");
          } else {
            brilloraices.classList.remove("visible");
          }
        }

        // Descendiente vinculado a un % de la altura del árbol
        if(descendiente){
          const forestHeight = forest.clientHeight;
          const targetY = forestHeight * 0.2; // 👈 cambia el 0.7 para moverlo
          descendiente.style.transform =
            `translateX(calc(-50% + ${offsetX}px)) translateY(${offset + targetY}px)`;
        }
      }

      ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive:true});

    // --- Parallax con mouse ---
    const cloudsLayer = document.getElementById("layer-clouds");
    const mountainsLayer = document.getElementById("layer-mountains");

    const moveFactorX = 0.02;
    const moveFactorY = 0.04;

    window.addEventListener("mousemove", e => {
      const x = (e.clientX / window.innerWidth) - 0.5;
      const y = (e.clientY / window.innerHeight) - 0.5;

      // Moon
      const moonScrollY = parseFloat(moonLayer.dataset.scrollY || 0);
      const moonTranslateX = x * moveFactorX * 200;
      const moonTranslateY = y * moveFactorY * 200;
      moonLayer.style.backgroundPosition =
        `${50 + moonTranslateX}% ${moonScrollY + moonTranslateY}px`;

      // Clouds
      const cloudsScrollY = parseFloat(cloudsLayer.dataset.scrollY || 0);
      const cloudsTranslateY = y * moveFactorY * 80;
      const cloudsTranslateX = Math.min(0, x * moveFactorX * 200);
      cloudsLayer.style.transform =
        `translateX(calc(-50% + ${cloudsTranslateX}px)) translateY(${cloudsScrollY + cloudsTranslateY}px)`;

      // Mountains
      const mountainsScrollY = parseFloat(mountainsLayer.dataset.scrollY || 0);
      const mTranslateX = x * moveFactorX * -500;
      const mTranslateY = y * moveFactorY * 500;
      mountainsLayer.style.transform =
        `translateX(calc(-50% + ${mTranslateX}px)) translateY(${mountainsScrollY + mTranslateY}px)`;
    });
  </script>
</body>
</html>
```
