<!doctype html>

<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parallax Storytelling — Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@900&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0f;
      --muted:#d6d6d8;
    }
    html, body {
      min-height: 100%;
      margin: 0;
      font-family: 'Merriweather', serif;
      background-color: var(--bg);


  background-image: 
    url("img/pasto-recortado.png"),
    url("img/pasto-recortado.png");
  background-repeat: 
    no-repeat,
    repeat-y;
  background-position: 
    center top,
    center top;
  background-size: 
    cover,
    cover;
  color: var(--muted);
}

.container { position:relative; width:100%; overflow:visible; }

.stage {
  position: relative;
  height: 100vh;
  min-height: 100vh;
  overflow: hidden;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  text-align: center;
  flex-direction: column;
}

.parallax-layer{
  position:absolute;
  top:0;
  left:50%;
  transform:translateX(-50%);
  will-change:transform;
  pointer-events:none;
  width:100vw;
  height:auto;
  max-width:none;
  object-fit:cover;
}

#layer-forest{
  position:absolute;
  top:0;
  left:50%;
  transform:translateX(-50%);
  width:100vw;
  height:auto;
  max-width:none;
  pointer-events:none;
  z-index:100;
  will-change:transform;
}

.layer-title{
  position:relative;
  z-index:102;
  width:clamp(200px, 60vw, 600px);
  margin:6vh auto 1rem;
  display:block;
}

section.story {
  position: relative;
  z-index: 2;
  min-height: 70vh;
  padding: 8vh 8vw;
  display: flex;
  align-items: flex-start;  /* contenido alineado arriba a la izquierda */
  justify-content: center;
  flex-direction: column;
  text-align: left;         /* asegura alineación de texto */
}

section.story h2 {
  font-size: clamp(18px, 4vw, 28px);
  margin-bottom: 1rem;
  color: #fff;
}

section.story p {
  font-size: clamp(14px, 2.5vw, 18px);
  line-height: 1.6;
  color: #fff;
}
section.story h2,
section.story p {
  max-width: 600px;         /* límite de ancho para mejor lectura */
  margin-left: 0vw;         /* separación desde el borde izquierdo */
}

.parallax-descendiente {
  position: absolute;
  left: 55%;
  top: 35%;
  transform: translateX(-50%) translateY(600px) scale(1.2); /* +20% */
  width: clamp(260px, 70vw, 2000px);
  z-index: 102;
  pointer-events: none;
}
/* Celulares → más alto */
@media (max-width: 768px) {
  .stage {
    height: 130vh;     /* más alto que el viewport */
    min-height: 800px; /* asegura altura suficiente */
  }
  section.story {
    min-height: 90vh;  /* más aire entre secciones */
  }
  .parallax-descendiente {
    top: 55%;
    transform: translateX(-50%) translateY(450px);
  }
}

/* Pantallas muy pequeñas (ej: 480px) */
@media (max-width: 480px) {
  .stage {
    height: 150vh;
    min-height: 950px;
  }
  section.story {
    min-height: 100vh;
  }
}


  </style>
</head>
<body>
  <div class="container">
    <div class="stage" id="stage">
      <img class="parallax-layer" id="layer-moon" src="img/arbolesfondo-solo.png" alt="luna" />
      <img class="parallax-layer" id="layer-clouds" src="img/arbol-amarillo.png" alt="nubes" />
      <img class="parallax-layer" id="layer-mountains" src="img/selen.png" alt="montañas" />
      <img class="layer-title" id="layer-foreground" src="img/morthalis.png" alt="Título gráfico" />
    </div>


<!-- Árbol -->
<img class="parallax-layer" id="layer-forest" src="img/arbol.png" alt="bosque" />

<img class="parallax-descendiente" id="layer-descendiente" src="img/descendiente.png" alt="descendiente" />

<section id="chapter1" class="story">
  <h2 class="subtitulo">Un nuevo eco en el silencio</h2>
  <p class="parrafo">
 La ausencia tiene un nuevo nombre, 
 y no es el final. Se dice que al partir, 
 el alma no se desvanece, sino que se alza, enraizada. 
 El recuerdo se vuelve tangible, custodiado en un cristal que pulsa con la memoria colectiva. 
 ¿Es la muerte una metamorfosis? Prepárate para el evento que redefinirá el legado y la conexión. 
 El ciclo está por revelarse.</p>
</section>

  </div>

<script>
  const layers = [
    {el: document.getElementById('layer-moon'), speed: 0.22},
    {el: document.getElementById('layer-clouds'), speed: 0.33},
    {el: document.getElementById('layer-mountains'), speed: 0.45}
  ];

  const forest = document.getElementById('layer-forest');
  const descendiente = document.getElementById('layer-descendiente');
  const chapter1 = document.getElementById('chapter1');

  let latestKnownScrollY = 0, ticking = false;

  function onScroll(){
    latestKnownScrollY = window.scrollY || window.pageYOffset;
    if(!ticking){ requestAnimationFrame(update); }
    ticking = true;
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  function update(){
    const y = latestKnownScrollY;

    // capas normales
    layers.forEach(layer=>{
      const factor = layer.speed;
      const translate = y * factor;
      layer.el.style.transform = `translateX(-50%) translateY(${translate}px)`;
    });

    // Árbol
    if(forest && chapter1){
      const limite = chapter1.offsetTop - window.innerHeight * 0.9;
      const offset = Math.min(y, limite);
      forest.style.transform = `translateX(-50%) translateY(${offset}px)`;
    }

    // Descendiente
    if(descendiente && chapter1){
      const startY = 900;
      const endY   = -140;
      const startOffsetFactor = 0.9;
      const endOffsetFactor   = 0.12;

      const chapterTopAbs = chapter1.offsetTop;
      const startScroll = chapterTopAbs - window.innerHeight * startOffsetFactor;
      const endScroll   = chapterTopAbs + window.innerHeight * endOffsetFactor;

      const denom = (endScroll - startScroll) || 1;
      const rawProgress = (y - startScroll) / denom;
      const progress = clamp(rawProgress, 0, 1);

      const translateY = startY + (endY - startY) * progress;
      descendiente.style.transform = `translateX(-50%) translateY(${translateY}px)`;
    }

    ticking = false;
  }

  window.addEventListener('scroll', onScroll, {passive:true});
</script>

</body>
</html>
